name: Build OpenSSL for Windows
on:
  workflow_dispatch:
    inputs:
      sslref:
        description: "OpenSSL version to build (Branch name)"
        required: true
        default: 'openssl-3.5'

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Install Deps
        shell: cmd
        run: |
              set PATH=%PATH%;%programfiles%\7-Zip\
              curl -o "nasm.zip" "https://www.nasm.us/pub/nasm/releasebuilds/2.16.03/win64/nasm-2.16.03-win64.zip"
              7z e -tzip -o"%programfiles%\nasm" "nasm.zip"
      - name: Clone OpenSSL
        uses: actions/checkout@v5
        with:
          repository: openssl/openssl
          ref: ${{ inputs.sslref }}
      - name: Configure MSVC CMD for amd64
        uses: ilammy/msvc-dev-cmd@v1.13.0
        with:
          arch: amd64
      - name: Build OpenSSL
        shell: cmd
        run: |
              set PATH=%PATH%;%programfiles%\7-Zip\;%programfiles%\nasm
              perl Configure VC-WIN64A
              nmake
              nmake test
              nmake install
      # 7z a -tzip -mx9 -o"%userprofile%" "openssl-amd64.zip" "%programfiles%\OpenSSL\"
      - name: Upload OpenSSL
        uses: actions/upload-artifact@v4
        with:
          name: opensslforwin
          path: ${{ env.PROGRAMFILES }}\OpenSSL\
          compression-level: 9
          include-hidden-files: true
          
              
    
